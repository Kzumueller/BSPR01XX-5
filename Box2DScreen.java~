import com.badlogic.gdx.Screen;
import com.badlogic.gdx.Gdx;
import com.badlogic.gdx.physics.box2d.World;
import com.badlogic.gdx.math.Vector2;
import com.badlogic.gdx.graphics.GL10;
import com.badlogic.gdx.graphics.g2d.TextureAtlas;
import com.badlogic.gdx.scenes.scene2d.Stage;
import com.badlogic.gdx.physics.box2d.Body;
import com.badlogic.gdx.physics.box2d.Shape;
import com.badlogic.gdx.scenes.scene2d.Action;
import com.badlogic.gdx.scenes.scene2d.actions.Actions;
import com.badlogic.gdx.utils.Array;
import com.badlogic.gdx.graphics.g2d.TextureRegion;

public class Box2DScreen implements Screen
{

  World world;
  Stage stage;

  final static String names[] = {"circle", "rectangle", "quad"};
  Array<String> objectArray = new Array<String>(names);

  public void show()
  {
    stage = new Stage();
    world = new World(new Vector2(0,-9.91f), true);
    final TextureAtlas atlas = new TextureAtlas(Gdx.files.internal("data/sprites-packed/pack.atlas"));
    
    Body floor = Box2DTools.createStaticBody(world, Gdx.graphics.getWidth()*0.5f, -8f);
    Shape floorBox = Box2DTools.createBoxShape(Gdx.graphics.getWidth(), 16);
    Box2DTools.addFixtureToBody( floor, floorBox );
    
    stage.getRoot().addAction(Actions.forever(Actions.sequence(
     Actions.delay(0.75f),new Action() {
       public boolean act(float delta)
       {
	 String s = objectArray.random();
	 int x = (int)(java.lang.Math.random() * Gdx.graphics.getWidth());
         Body body = Box2DTools.createDynamicBody(world, x, 700);
	 Box2DActor actor;
	 if (s == "circle")
	   actor = createCircleActor(body, atlas.findRegion("circle"));
	else if (s == "quad")	
           actor = createBoxActor(body, atlas.findRegion("quad"));
	else 
	   actor = createBoxActor(body, atlas.findRegion("rectangle"));
	stage.addActor(actor);
	return true;
        }}))); 
  }

  public void render(float delta)
  {
    Gdx.gl.glClear(GL10.GL_COLOR_BUFFER_BIT);
    world.step(delta, 8, 6);
    stage.act(delta);
    stage.draw();
  }

  public void dispose()
  {
  }

  public void pause()
  {
  }

  public void resume()
  {
  }

  public void hide()
  {
  }

  public void resize(int w, int h)
  {
  }

  public Box2DActor createCircleActor(Body body, TextureRegion region)
  { 
    Shape circle = Box2DTools.createCircleShape(region.getRegionWidth());
    Box2DTools.addFixtureToBody( body, circle );
    return new Box2DActor(body, region);
  }

  public Box2DActor createBoxActor(Body body, TextureRegion region)
  {
    Shape box = Box2DTools.createBoxShape(region.getRegionWidth(), region.getRegionHeight());
    Box2DTools.addFixtureToBody( body, box );
    return new Box2DActor(body, region);
  }
}
